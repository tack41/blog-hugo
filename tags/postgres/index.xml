<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>postgres on tack41&#39;s blog</title>
    <link>https://blog.tack41.net/tags/postgres/</link>
    <description>Recent content in postgres on tack41&#39;s blog</description>
    <image>
      <url>https://blog.tack41.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</url>
      <link>https://blog.tack41.net/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E</link>
    </image>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Fri, 01 Apr 2022 00:00:00 +0900</lastBuildDate><atom:link href="https://blog.tack41.net/tags/postgres/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>RedmineのDBをPostgreSQLからMariaDBに移行</title>
      <link>https://blog.tack41.net/posts/2022/04/01_01/</link>
      <pubDate>Fri, 01 Apr 2022 00:00:00 +0900</pubDate>
      
      <guid>https://blog.tack41.net/posts/2022/04/01_01/</guid>
      <description>TL;DR Redmine 4.2.5にて、yaml_dbを利用することでPostgreSQL(14.2)からMariaDB(10.4.24)に移行できました 経緯 GCPのVMの無料枠(e2-small,Mem:1GB,HDD:30GB)で以下のDockerコンテナクラスタ(docker-compose)でredmineを運用しています。
redmine: 4.2.5-alpihne postgres: 14.2-alpine steveltn/https-portal: 1.21.1 環境が激poorなこともありますが、たまにアクセスするとページが表示されるまで10秒近く待たされることも。そこで、より軽量と思われるMySQL系のMariaDB(10.4.24)に移行しました。パフォーマンスが改善されたかどうかは、現在様子見です。
以下の手順を踏みました。
コンテナクラスタを停止 docker-compose.ymlにMariaDBコンテナを追加し、redmineコンテナから接続できるようnetwork設定し、rootた上で起動 docker-compose execコマンドでredmineコンテナに接続 apk-add mariadb-clientを実行してクライアントツールをインストール /usr/src/redmine/config/database.ymlのバックアップを取得した上で、記述をMariaDBに接続できるよう(adapterはmysql2) mysqlコマンドでMariaDBコンテナに接続し、Install Redmineの手順を参考にDBを作成 Install Redmine](https://www.redmine.org/projects/redmine/wiki/redmineinstall)の手順を参考にrake db:migrateでDBを初期化 /usr/src/redmine/Gemfileにgem &amp;quot;yaml_db&amp;quot;の記述を追加してgem bundle updateを実行。エラーとなるが、途中yaml_dbのインストールが成功していればOK /usr/src/redmine/config/database.ymlを更にバックアップした上で、前にバックアップしていたPostgreSQL用の設定に戻してRAILS_ENV=production bundle exec rake db:data:dumpを実行。/usr/src/redmine/db/data.ymlにバックアップが作成される /usr/src/redmine/config/database.ymlをMariaDBの設定に戻し、RAILS_ENV=production bundle exec rake db:data:loadを実行。 mysqlコマンドでMariaDBコンテナに接続し、データがリストアされていることを確認 docker-compose.ymlのPostgreSQLコンテナの記述を削除し、redmineコンテナからMariaDBコンテナに接続するよう設定を修正した上で起動。 参考サイト: https://hnron.hatenablog.com/entry/2015/08/18/012738</description>
    </item>
    
  </channel>
</rss>
